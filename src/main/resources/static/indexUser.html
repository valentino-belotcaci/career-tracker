<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="stylesheet" href="/css/style.css">
	<title>User Dashboard</title>
</head>
<body>
<header>
	<a class="site-title" href="/indexUser.html">CareerTracker</a>
	
</header>
<main class="wide-card">
	<h2>User Dashboard</h2>
	<p>Welcome, user. Use the navigation to manage your data.</p>

	<div class="spaced">
		<a href="/profileUser.html"><button>View profile</button></a>
	</div>

	<div class="spaced">
		<a href="/displayJobApplication.html"><button>Job Applications</button></a>
	</div>
	<div class="spaced">	<button id="logoutBtn" class="btn" style="float:right">Logout</button>
</div>
</main>
<footer>
	<p>Â© 2026 CareerTracker</p>
</footer>

<script>
(function() {
  // ===== LOGGED-IN CHECK =====
  // Only need loggedId in localStorage for user identification
  const loggedId = localStorage.getItem('loggedId');
  if (!loggedId) {
    console.warn('No logged account id found, redirecting to login');
    window.location.href = '/login.html';
    return;
  }

  // ===== HELPER FOR AUTHENTICATED REQUESTS =====
  window.authFetch = function(url, opts = {}) {
    opts = opts || {};
    opts.credentials = 'include'; // automatically send HttpOnly cookie
    return fetch(url, opts);
  };

  // ===== LOGOUT =====
  document.getElementById('logoutBtn').addEventListener('click', async function() {
    try {
      // Call server logout endpoint to clear HttpOnly cookie
      await authFetch('/Account/logout', { method: 'POST' });
    } catch (_) {
      console.warn('Logout request failed; still clearing client data');
    }
    // Clear localStorage entries (keep loggedId optional)
    localStorage.removeItem('loggedId');
    localStorage.removeItem('loggenId');

    // redirect to home page
    window.location.href = '/index.html';
  });
})();
</script>

</html>
