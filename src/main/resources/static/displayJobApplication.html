<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Job Applications - CareerTracker</title>
    <link rel="stylesheet" href="/css/style.css">
  </head>
  <body>
    <header>
      <a class="site-title" href="/indexUser.html">CareerTracker</a>
    </header>

    <main class="wide-card">
      <h2>Available Job Posts</h2>
      <div style="margin-bottom:12px;">
        <!-- Removed standalone apply button; each row is clickable to view details and apply -->
      </div>
      <p id="note">Loading…</p>

      <table id="appsTable" style="width:100%; border-collapse: collapse; display:none;">
        <thead>
          <tr>
            <!-- Hidden ID and Company ID columns -->
            <th style="display:none; border:1px solid #ccc; padding:8px; text-align:left;">ID</th>
            <th style="display:none; border:1px solid #ccc; padding:8px; text-align:left;">Company ID</th>
            <th style="border:1px solid #ccc; padding:8px; text-align:left;">Name</th>
            <th style="border:1px solid #ccc; padding:8px; text-align:left;">Description</th>
            <th style="border:1px solid #ccc; padding:8px; text-align:left;">Duration</th>
            <th style="border:1px solid #ccc; padding:8px; text-align:left;">Available</th>
            <th style="border:1px solid #ccc; padding:8px; text-align:left;">Salary</th>
          </tr>
        </thead>
        <tbody id="appsBody"></tbody>
      </table>

      <p id="message"></p>
    </main>

    <footer>
      <p>© 2026 CareerTracker</p>
    </footer>

    <script>
      async function loadAllPosts() {
        const note = document.getElementById('note');
        try {
          const res = await fetch('/JobPost/getAllPosts');
          if (!res.ok) {
            if (res.status === 404) {
              note.textContent = 'No job posts found.';
              return;
            }
            throw new Error('Failed to load posts');
          }
          const posts = await res.json();
          if (!posts || posts.length === 0) {
            note.textContent = 'No job posts found.';
            return;
          }

          const tbody = document.getElementById('appsBody');
          tbody.innerHTML = '';
          posts.forEach(p => {
            const tr = document.createElement('tr');
            const idVal = p.post_id;
            const compVal = p.company_id;
            tr.innerHTML = `
                <td style="display:none; border:1px solid #ccc; padding:8px;">${idVal}</td>
                <td style="display:none; border:1px solid #ccc; padding:8px;">${compVal}</td>
              <td style="border:1px solid #ccc; padding:8px;">${p.name || ''}</td>
              <td style="border:1px solid #ccc; padding:8px;">${p.description || ''}</td>
              <td style="border:1px solid #ccc; padding:8px;">${p.duration || ''}</td>
              <td style="border:1px solid #ccc; padding:8px;">${p.available || ''}</td>
              <td style="border:1px solid #ccc; padding:8px;">${p.salary || ''}</td>
            `;

            // make the row clickable: open details page for the post
            tr.style.cursor = 'pointer';
            tr.addEventListener('click', () => {
              const postId = idVal;
              if (postId) {
                // navigate to details page with query param
                window.location.href = `/jobPostDetails.html?postId=${encodeURIComponent(postId)}`;
              }
            });

            tbody.appendChild(tr);
          });

          note.style.display = 'none';
          document.getElementById('appsTable').style.display = 'table';
        } catch (err) {
          console.error(err);
          note.textContent = 'Error loading job posts.';
        }
      }

      loadAllPosts();
    </script>
  </body>
</html>
