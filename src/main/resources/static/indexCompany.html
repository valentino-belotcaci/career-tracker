<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="stylesheet" href="/css/style.css">
	<title>Company Dashboard</title>
</head>
<body>
<header>
	<a class="site-title" href="/indexCompany.html">CareerTracker</a>
	<button id="logoutBtn" class="btn" style="float:right">Logout</button>
</header>
<main class="wide-card">
	<h2>Company Dashboard</h2>
	<p>Welcome, company. Use the navigation to manage your company profile.</p>

	<div class="spaced">
		<a href="/profileCompany.html"><button class="btn">View profile</button></a>
	</div>

	<div class="spaced">
		<div class="spaced">
		<a href="/displayJobPost.html"><button class="btn">Job Posts</button></a>
	</div>

	<script>
	document.getElementById('logoutBtn').addEventListener('click', async function () {
      try {
        // Call backend to clear cookie
        const res = await fetch('/Account/logout', {
          method: 'POST',
          credentials: 'include'
        });
        // Clear any client-side stored auth state
        try { localStorage.removeItem('jwt'); } catch(e){}
        try { localStorage.removeItem('loggedId'); } catch(e){}
        try { localStorage.removeItem('type'); } catch(e){}
        // Redirect to login regardless of backend response
        window.location.href = '/login.html';
      } catch (err) {
        // best-effort: clear client state and redirect
        try { localStorage.removeItem('jwt'); } catch(e){}
        window.location.href = '/login.html';
      }
    });
	</script>
</main>
<footer>
	<p>Â© 2026 CareerTracker</p>
</footer>
<script>
(function () {
  const token = localStorage.getItem('jwt');
  if (!token) {
    console.warn('No JWT found, redirecting to login');
    window.location.href = '/login.html';
    return;
  }

  // expose authFetch globally for other UI scripts on this page
  window.authFetch = function (url, opts = {}) {
    opts = opts || {};
    opts.headers = opts.headers || {};
    opts.headers = Object.assign({}, opts.headers, {
      'Authorization': 'Bearer ' + token
    });
    return fetch(url, opts);
  };

  // Example usage:
  // authFetch('/Company/profile/' + localStorage.getItem('loggenId'))
  //   .then(r => r.json()).then(console.log).catch(console.error);
})();
</script>
</body>
</html>
